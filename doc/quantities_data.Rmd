---
title: "Data Quantities"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
```

```{r}
library(drake)
library(tidyverse)
loadd(data, data_trans, data_mice)
```

Look at NA values in raw data
```{r}
map_int(data, ~sum(!is.na(.)))
data %>% 
  filter(pubcrawl_per_capita == 0 | is.na(pubcrawl_per_capita)) %>%
  nrow()
data %>% 
  filter(promed_mentions_per_capita == 0 | is.na( promed_mentions_per_capita)) %>%
  nrow()
data %>% 
  filter(ab_export_per_capita == 0 | is.na( ab_export_per_capita)) %>%
  nrow()

```

Look at NA values and distributions post-NA processing
```{r}
map_int(data_trans, ~sum(!is.na(.)))
map_lgl(data_trans, ~any(is.infinite(.))) # confirm no infinite values
data_trans %>%
  select(-iso3c, -n_amr_events, -english_spoken) %>%
  gather() %>%
  ggplot(aes(x = value)) +
  geom_histogram() + 
  facet_wrap(key~., scales = "free")
data_trans %>%
  dplyr::select(-iso3c, -ln_livestock_pcu, -ln_ab_import_per_capita, -ab_export_bin, -english_spoken) %>%
  PerformanceAnalytics::chart.Correlation(., histogram = TRUE, pch = 19, method = "spearman")
```

Look at imputed data

```{r}

plot(data_mice) # On convergence, the different streams should be freely intermingled with one another, without showing any definite trends. Convergence is diagnosed when the variance between different sequences is no larger than the variance within each individual sequence.
show_imputes(data_mice, m = data_mice[["m"]], raw = data_trans)
imp <- complete(data_mice)
imp %>%
  dplyr::select(-iso3c) %>%
  PerformanceAnalytics::chart.Correlation(., histogram = TRUE, pch = 19, method = "spearman")
```

